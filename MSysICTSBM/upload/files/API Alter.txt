CMS Publish 

--Alter Sp 
SP_GetHSHouseDetailsnew   --- update By rohit

-------------------------------

Alter Table HouseMaster Add New_Construction INT
Alter Table HouseMaster Add Remark nvarchar(255)
Alter Table LiquidWasteDetails Add Remark nvarchar(255)
Alter Table StreetSweepingDetails Add Remark nvarchar(255)
Alter Table DumpYardDetails Add Remark nvarchar(255)

--ALTER SP : GetQrWorkHistory
-----House


GO
/****** Object:  StoredProcedure [dbo].[SP_RejectHouseDetailsApp]    Script Date: 2/8/2023 5:11:37 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
  

  
CREATE  proc [dbo].[SP_RejectHouseDetailsApp]    
as    
begin    
SELECT H.userId      
        ,H.houseId      
        ,H.houseLat      
        ,H.houseLong      
        ,H.ReferanceId    
		,H.modified   
		,E.qrEmpName
		,H.QRStatus
		,H.Remark
   

    ,CASE           
         WHEN H.BinaryQrCodeImage IS NULL or H.BinaryQrCodeImage = ''           
            THEN '/Images/default_not_upload.png'            
           
			ELSE
   CONCAT('data:image/jpeg;base64,', '', (SELECT  CAST(H.BinaryQrCodeImage as varbinary(max)) FOR XML PATH(''), BINARY BASE64))    
   END as QRCodeImage  
  
        FROM HouseMaster H    
   left join QrEmployeeMaster E on H.userId = E.qrEmpId    
  where  H.houseLat is not null AND H.houseLong is not null and h.QRStatus=0  
   order by modified desc
  END

  
  

--exec SP_RejectHouseDetailsApp


  
  

------------------- Liquid


GO
/****** Object:  StoredProcedure [dbo].[SP_RejectLiquidDetailsApp]    Script Date: 2/3/2023 10:51:25 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE  proc [dbo].[SP_RejectLiquidDetailsApp]    
as    
begin    
SELECT L.userId    
        ,L.LWId    
        ,L.LWLat    
        ,L.LWLong    
        ,L.ReferanceId  
		,L.lastModifiedDate 
		,E.qrEmpName
		,L.QRStatus
		,L.Remark
   

  ,CASE         
         WHEN L.BinaryQrCodeImage IS NULL or L.BinaryQrCodeImage = ''         
            THEN NULL         
            ELSE  
			CONCAT('data:image/jpeg;base64,', '', (SELECT CAST(L.BinaryQrCodeImage as varbinary(max)) FOR XML PATH(''), BINARY BASE64))  
			END as QRCodeImage   

        FROM LiquidWasteDetails L     
		left join QrEmployeeMaster E on L.userId = E.qrEmpId  
		where L.LWLat is not null AND L.LWLong is not null and QRStatus=0 

  END

  
  

--exec SP_RejectLiquidDetailsApp


  
  ----------- Street


GO
/****** Object:  StoredProcedure [dbo].[SP_RejectStreetDetailsApp]    Script Date: 2/3/2023 10:51:25 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE  proc [dbo].[SP_RejectStreetDetailsApp]    
as    
begin    
SELECT S.userId    
        ,S.SSId    
        ,S.SSLat    
        ,S.SSLong    
        ,S.ReferanceId  
		,S.lastModifiedDate 
		,E.qrEmpName
		,S.QRStatus
		,S.Remark
   

  ,CASE         
         WHEN S.BinaryQrCodeImage IS NULL or S.BinaryQrCodeImage = ''         
            THEN NULL         
            ELSE  
			CONCAT('data:image/jpeg;base64,', '', (SELECT CAST(S.BinaryQrCodeImage as varbinary(max)) FOR XML PATH(''), BINARY BASE64))  
			END as QRCodeImage   

        FROM StreetSweepingDetails S 
		
		left join QrEmployeeMaster E on S.userId = E.qrEmpId  
		where S.SSLat is not null AND S.SSLong is not null 
		AND QRStatus=0 

  END

  
  

--exec SP_RejectStreetDetailsApp


  
  
-- DumpYard


GO
/****** Object:  StoredProcedure [dbo].[SP_RejectDumpYardDetailsApp]    Script Date: 2/3/2023 10:51:25 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE  proc [dbo].[SP_RejectDumpYardDetailsApp]    
as    
begin    
SELECT D.userId    
        ,D.dyId    
        ,D.dyLat    
        ,D.dyLong    
        ,D.ReferanceId  
		,D.lastModifiedDate 
		,E.qrEmpName
		,D.QRStatus
		,D.Remark
   

   ,CASE         
         WHEN D.BinaryQrCodeImage IS NULL or D.BinaryQrCodeImage = ''         
            THEN NULL         
            ELSE  
			CONCAT('data:image/jpeg;base64,', '', (SELECT CAST(D.BinaryQrCodeImage as varbinary(max)) FOR XML PATH(''), BINARY BASE64))  
			END as QRCodeImage 
        FROM DumpYardDetails D 
		
	    left join QrEmployeeMaster E on D.userId = E.qrEmpId  
		where D.dyLat is not null AND D.dyLong is not null 
		AND QRStatus=0 

  END

  
  

--exec SP_RejectDumpYardDetailsApp


  
  